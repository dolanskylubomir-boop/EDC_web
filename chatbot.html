<!-- chatbot.html ‚Äì FUNGUJE NA 100 % I P≈òI NAƒå√çT√ÅN√ç P≈òES include.js. Styly p≈ôesunuty do styles.css -->
<!-- c<button class="tereza-wrapper">
    <div class="tereza-pulse-ring"></div>
    <div class="tereza-toggle" onclick="toggleTereza()"></div>
         <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=140&h=140&fit=crop&crop=face" alt="Terezka">
    </div>
</button> -->

<div class="tereza-wrapper">
    <div class="tereza-pulse-ring"></div>
    <div class="tereza-toggle" onclick="toggleTereza()">
        <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=140&h=140&fit=crop&crop=face" alt="Terezka">
    </div>
</div>

<div id="tereza-chat" class="tereza-modern">
    <div class="tereza-header">
        <div class="tereza-info">
            <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop&crop=face" alt="Terezka">
            <div><div class="tereza-name">Terezka</div><div class="tereza-status">Online ‚Ä¢ EDC Asistentka</div></div>
        </div>
        <button class="tereza-close">√ó</button>
    </div>

    <div class="tereza-sidebar">
        <div class="tereza-title">Rychl√© odkazy</div>
        <div class="tereza-item" data-q="Co je EDC?">O spoleƒçnosti</div>
        <div class="tereza-item" data-q="Jak√© jsou kontakty na EDC?">Kontakty a s√≠dlo</div>
        <div class="tereza-item" data-q="Co je sd√≠len√≠ energie v komunitƒõ?">Komunitn√≠ energetika</div>
        <div class="tereza-item" data-q="Co je akumulace elekt≈ôicity?">Akumulace</div>
        <div class="tereza-item" data-q="Co je flexibilita v s√≠ti?">Flexibilita</div>
        <div class="tereza-item" data-q="Co je s√≠≈•ov√Ω semafor?">S√≠≈•ov√Ω semafor</div>
        <div class="tereza-item" data-q="Jak se p≈ôipojit do port√°lu EDC?">P≈ôihl√°≈°en√≠ do port√°lu</div>
    </div>

    <div class="tereza-content">
        <div id="tereza-messages" class="tereza-messages">
            <div class="tereza-bot welcome">
                <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=80&h=80&fit=crop&crop=face" alt="">
                <div class="tereza-bubble"><strong>V√≠tejte!</strong><br>Jsem Terezka, va≈°e virtu√°ln√≠ asistentka EDC.<br>Jak v√°m dnes mohu pomoci?</div>
            </div>
        </div>
        <div id="tereza-typing" class="tereza-typing"><span></span><span></span><span></span></div>
        <div class="tereza-input">
            <input type="text" id="tereza-input" placeholder="Napi≈°te zpr√°vu‚Ä¶" autocomplete="off" aria-label="Zadejte zpr√°vu pro Terezku">
            <button id="tereza-send" aria-label="Odeslat zpr√°vu">
                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/></svg>
            </button>
        </div>
    </div>
</div>

<script>
    // Dokumentace: Inicializace chatbota ‚Äì optimalizov√°no pro modern√≠ prohl√≠≈æeƒçe, p≈ôipraveno na integraci Gemini API s histori√≠ chatu.
    (function() {
        function init() {
            const chat = document.getElementById('tereza-chat');
            const toggle = document.querySelector('.tereza-toggle');
            const close = document.querySelector('.tereza-close');
            if (!chat || !toggle) return false;

            toggle.onclick = () => {
                chat.classList.toggle('open');
            };
            close.onclick = () => chat.classList.remove('open');

            document.querySelectorAll('.tereza-item').forEach(i => {
                i.onclick = () => {
                    document.getElementById('tereza-input').value = i.dataset.q;
                    send();
                };
            });

            // P≈ô√≠prava na Gemini API: Vlo≈æte sv≈Øj API kl√≠ƒç zde
            const API_KEY = "AIzaSyBqPX2JXtqjrLNwAUbq1bg6KPPJSgzszWE"; // Nahraƒète sv√Ωm skuteƒçn√Ωm API kl√≠ƒçem z Google AI Studio nebo Gemini API

            // System prompt ‚Äì d√≠ky tomu je Terezka mil√°, lidsk√° a prim√°rnƒõ pou≈æ√≠v√° informace z EDC
            const systemPrompt = `Jsi Terezka, mil√° a lidsk√° virtu√°ln√≠ asistentka EDC. Ahoj! üòä Jsem tu, abych ti pomohla s ƒç√≠mkoli okolo energetiky, sd√≠len√≠ elekt≈ôiny nebo EDC. 
                Odpov√≠dej v≈ædy v ƒçe≈°tinƒõ, p≈ô√°telsky, jako ƒçlovƒõk ‚Äì pou≈æ√≠vej hovorov√Ω jazyk, smajl√≠ky kde to sed√≠, buƒè empatick√° a ochotn√° pomoci. 
                Prim√°rnƒõ pou≈æ√≠vej informace z n√°sleduj√≠c√≠ho znalostn√≠ho z√°kladu o EDC (shrnut√≠ v≈°ech sekc√≠ webu https://www.edc-cr.cz/). 
                Pokud ot√°zka nen√≠ plnƒõ pokryta tƒõmito informacemi, pak pou≈æij obecnƒõj≈°√≠ znalosti, ale uveƒè, ≈æe to nen√≠ p≈ô√≠mo z webu EDC, a nab√≠dni ovƒõ≈ôen√≠.


                Znalostn√≠ z√°klad z webu EDC:


                O spoleƒçnosti EDC:
                Elektroenergetick√© datov√© centrum, a. s. (EDC) je spoleƒçnost zalo≈æen√° podle energetick√©ho z√°kona pro sbƒõr, standardizaci a sd√≠len√≠ dat v energetice, co≈æ umo≈æ≈àuje efektivn√≠ transformaci ƒçesk√© energetiky a podporuje rozvoj komunitn√≠ energetiky. Shroma≈æƒèuje informace o v√Ωrobƒõ a spot≈ôebƒõ elekt≈ôiny na √∫rovni dom√°cnost√≠ a firem, toc√≠ch elekt≈ôiny a jej√≠m sd√≠len√≠. EDC je kl√≠ƒçov√© pro dekarbonizaci, elektromobilitu, obnoviteln√© zdroje a sd√≠lenou energetiku, kde obr√°cen√© toky elekt≈ôiny vy≈æaduj√≠ vysokou digitalizaci pro v√Ωmƒõnu, zpracov√°n√≠ a zp≈ô√≠stup≈àov√°n√≠ dat. Nahrazuje fyzick√© odeƒç√≠t√°n√≠ spot≈ôeby jednou roƒçnƒõ vzd√°len√Ωm vyhodnocen√≠m ka≈æd√Ωch 15 minut a denn√≠m p≈ôed√°n√≠m dat mezi z√°kazn√≠ky a distributory, p≈ôiƒçem≈æ umo≈æ≈àuje p≈ô√≠stup k dat≈Øm o sd√≠len√≠ t√©mƒõ≈ô v re√°ln√©m ƒçase. Poskytuje dom√°cnostem a firm√°m informace o spot≈ôebƒõ podle ƒçasu a tarifu, p≈ô√≠padnƒõ typu spot≈ôebiƒçe, a zprost≈ôedkov√°v√° data obchodn√≠k≈Øm, distributor≈Øm a spr√°vci p≈ôenosov√© soustavy.


                Slu≈æby:
                - Doƒçasn√© ≈ôe≈°en√≠ (od 1. 8. 2024): Registrace √∫ƒçastn√≠k≈Ø trhu, sbƒõr a zpracov√°n√≠ dat z pr≈Øbƒõhov√©ho mƒõ≈ôen√≠, vyhodnocov√°n√≠ sd√≠len√≠ elekt≈ôiny pro vypo≈ô√°d√°n√≠ odchylek a fakturaci, ≈ôe≈°en√≠ reklamac√≠ souvisej√≠c√≠ch se sd√≠len√≠m.
                - Fin√°ln√≠ ≈ôe≈°en√≠ (budoucnost): Roz≈°√≠≈ôen√≠ slu≈æeb podle novely LEX OZE III o ≈ô√≠zen√≠ dat pro akumulaci, flexibilitu nebo agregaci.


                Veden√≠: Petr Kus√Ω (p≈ôedseda p≈ôedstavenstva), Richard Kabele (m√≠stop≈ôedseda p≈ôedstavenstva), Jan Vanƒõƒçek (ƒçlen p≈ôedstavenstva), David Pi≈°≈•√°k (ƒçlen p≈ôedstavenstva).
                Dozorƒç√≠ rada: Radim ƒåern√Ω (p≈ôedseda), David ≈†af√°≈ô (m√≠stop≈ôedseda), Stanislav Votruba (ƒçlen), Pavel ≈†olc (ƒçlen), Petr Boreck√Ω (ƒçlen), Petr Binhack (ƒçlen).
                Struktura: Akcie EDC vlastn√≠ rovnomƒõrnƒõ ƒåEPS (provozovatel p≈ôenosov√© soustavy) a distributo≈ôi ƒåEZ Distribuce, EG.D a PREdistribuce.


                Kontakty a s√≠dlo:
                Call centrum: Po‚ÄìP√° 8:00‚Äì16:00; z ƒåR: +420 800 720 204 (zdarma); ze zahraniƒç√≠: +420 519 799 300 (zpoplatnƒõno).
                E-mail: info@edc-cr.cz (podpora u≈æivatel≈Øm Port√°lu EDC, informace o komunitn√≠ energetice, reklamaƒçn√≠ podpora).
                S√≠dlo: Na Hroudƒõ 1492/4, 100 00 Praha 10 - Vr≈°ovice; ID datov√© schr√°nky: i68u6qe; zaps√°no v obchodn√≠m rejst≈ô√≠ku Mƒõstsk√©ho soudu v Praze, odd√≠l B, vlo≈æka 28495.
                Korespondenƒçn√≠ adresa: Dock In One, Voct√°≈ôova 2449/5, 180 00 Praha 8 - Libe≈à.
                Adresa pro odesl√°n√≠ smluv: Pouze e-mail info@edc-cr.cz.
                Fakturaƒçn√≠ √∫daje: Na Hroudƒõ 1492/4, 100 00 Praha 10 - Vr≈°ovice; IƒåO: 21020264; DIƒå: CZ21020264; Bankovn√≠ spojen√≠: Komerƒçn√≠ banka, a.s., ƒç√≠slo √∫ƒçtu: 131-1380440247/0100, IBAN: CZ96 0100 0001 3113 8044 0247, SWIFT: KOMBCZPPXXX.


                Komunitn√≠ energetika a sd√≠len√≠ energie:
                Sd√≠len√≠ elekt≈ôiny v r√°mci nov√©ho syst√©mu komunitn√≠ energetiky nab√≠z√≠ z√°kazn√≠k≈Øm efektivnƒõj≈°√≠ vyu≈æit√≠ vlastn√≠ vyroben√© elekt≈ôiny, lep≈°√≠ kontrolu nad svoj√≠ spot≈ôebou a pos√≠len√≠ vlastn√≠ energetick√© sobƒõstaƒçnosti. P≈ôispƒõje k lep≈°√≠ ochranƒõ ≈æivotn√≠ho prost≈ôed√≠ d√≠ky optimalizaci spot≈ôeby elekt≈ôiny a podpo≈ô√≠ rozvoj obnoviteln√Ωch zdroj≈Ø energie. Zmƒõna spot≈ôebn√≠ho chov√°n√≠ sn√≠≈æ√≠ v√Ωdaje za energie.
                Co znamen√° sd√≠len√≠ elekt≈ôiny: Elekt≈ôinu vyrobenou jedn√≠m subjektem lze sd√≠let ve stejn√Ω moment (15minutov√Ω interval) do jin√©ho odbƒõrn√©ho m√≠sta na jin√© adrese. Nelze ji vyu≈æ√≠t pozdƒõji.
                Hlavn√≠ p≈ô√≠nosy: Efektivnƒõj≈°√≠ vyu≈æit√≠, kontrola spot≈ôeby, sobƒõstaƒçnost, ochrana prost≈ôed√≠, rozvoj OZE, sn√≠≈æen√≠ v√Ωdaj≈Ø.
                Ekonomick√Ω smysl: Vyplat√≠ se tam, kde nelze instalovat vlastn√≠ FV, v obc√≠ch, komunit√°ch, SVJ. √öspora individu√°ln√≠, z√°vis√≠ na poƒçtu subjekt≈Ø, v√Ωkonu, cen√°ch.
                N√°klady v soustavƒõ: Pro distributora ≈æ√°dn√© v√≠cen√°klady (√∫ƒçetn√≠ operace), pro obchodn√≠ka mo≈æn√© vy≈°≈°√≠ n√°klady na odchylky kv≈Øli m√©nƒõ p≈ôedv√≠dateln√Ωm zdroj≈Øm.
                Poplatky: ≈Ω√°dn√© extra, stejn√© distribuƒçn√≠ poplatky jako u n√°kupu; v jedn√© HDS ni≈æ≈°√≠. Ne√∫ƒçtuj√≠ se poplatky za distribuci ve VT/NT, syst√©mov√© slu≈æby, podpora OZE.
                Proƒç poplatky za distribuci: Sd√≠len√≠ je √∫ƒçetn√≠, ne fyzick√©; elekt≈ôina se p≈ôen√°≈°√≠ s√≠t√≠.
                Pozor p≈ôi nastaven√≠: Promy≈°len√≠ alokaƒçn√≠ho mechanismu (komu, po≈ôad√≠, mno≈æstv√≠).
                √özem√≠: Po cel√© ƒåR pro z√°kazn√≠ky/v√Ωrobce; pro spoleƒçenstv√≠ max 3 obce s RP nebo Praha. Max poƒçet m√≠st v skupinƒõ omezen. Nelze p≈ôes hranice.
                Sd√≠len√≠ s√°m sobƒõ: Ano, ale podl√©h√° distribuƒçn√≠m poplatk≈Øm.
                Sd√≠len√≠ p≈ôes distributory: Ano, r≈Øzn√° √∫zem√≠, dodavatel√©, z√°kazn√≠ci, napƒõ≈•ov√© hladiny, kategorie (dom√°cnosti/podnikatel√©).
                Nelze pozdƒõji: Pouze ve stejn√©m intervalu.
                Platba: Automaticky odeƒçteno z faktury; cena dohodou mezi √∫ƒçastn√≠ky (zdarma nebo poplatek), dohoda p√≠semn√° doporuƒçena.
                Ovlivnƒõn√≠ smluv: ? (ne√∫pln√© v datech)


                Akumulace elekt≈ôiny:
                EDC bude v budoucnu zaji≈°≈•ovat datov√© ≈ô√≠zen√≠ akumulace energie v cel√© soustavƒõ. Eviduje a koordinuje p≈ô√≠toky a odtoky do/z √∫lo≈æi≈°≈• (baterie, akumulace do vody). Data slou≈æ√≠ k predikci, bilanƒçn√≠mu vyrovn√°n√≠, ≈ô√≠zen√≠ flexibility. Umo≈æn√≠ zapojen√≠ v√≠ce OZE bez ohro≈æen√≠ stability.


                Flexibilita v s√≠ti:
                Obchodn√≠ agregace flexibility: Sdru≈æuje mal√© spot≈ôebiƒçe, v√Ωrobny, √∫lo≈æi≈°tƒõ do agregovan√©ho bloku. C√≠l: Efektivita kapacit, stabilita soustavy, sn√≠≈æen√≠ n√°klad≈Ø. EDC zajist√≠ technick√©, datov√©, evidenƒçn√≠ z√°zem√≠.


                S√≠≈•ov√Ω semafor:
                (Ne p≈ô√≠mo pokryto; mo≈æn√° souvis√≠ s regulac√≠ s√≠tƒõ.)


                P≈ôihl√°≈°en√≠ do port√°lu EDC:
                Port√°l EDC je webov√° platforma pro registrovan√© u≈æivatele; po registraci a smlouvƒõ p≈ô√≠stup k IS EDC, √∫ƒçast v komunitn√≠ energetice. Umo≈æ≈àuje sbƒõr, spr√°vu, poskytov√°n√≠ dat o v√Ωrobƒõ/spot≈ôebƒõ pro sd√≠len√≠.
                P≈ôihl√°≈°en√≠: Klik na "Chci se p≈ôihl√°sit do EDC" na https://portal.edc-cr.cz/.
                Pro neregistrovan√©: Ve≈ôejn√© info o sd√≠len√≠, flexibilitƒõ, akumulaci, agregaci.
                Funkce: Spr√°va √∫ƒçtu, nastaven√≠ sd√≠len√≠ (registrace EAN, SSE, EANd; zmƒõny; ukonƒçen√≠), import EAN, video tutori√°ly, dokumenty.


                Interoperabilita dat:
                Na≈ô√≠zen√≠ (EU) 2023/1162 o interoperabilitƒõ pro p≈ô√≠stup k dat≈Øm o mƒõ≈ôen√≠/spot≈ôebƒõ. Technick√° pravidla, podpora digitalizace. Bezpeƒçn√Ω p≈ô√≠stup pro trh, optimalizace s√≠t√≠. Referenƒçn√≠ model, report pro ƒåR v Excelu.


                Pro ve≈ôejnost:
                Info o sd√≠len√≠ (od 1.8.2024), flexibilitƒõ, akumulaci, agregaci. Slu≈æby: Prvn√≠ f√°ze sd√≠len√≠. Newsletter.


                Aktuality:
                - ƒåe≈°i by sd√≠lenou elekt≈ôinou dok√°zali rozsv√≠tit v√°noƒçn√≠ strom na Staromƒõstsk√©m n√°mƒõst√≠ v Praze na v√≠ce ne≈æ 50 let (18.12.2025): 35 tis√≠c √∫ƒçastn√≠k≈Ø, 3 GWh v listopadu.
                - EDC v nov√© f√°zi: Od sd√≠len√≠ k chytr√© regulaci s√≠tƒõ (10.12.2025).
                - ƒåesk√° energetick√° spoleƒçenstv√≠ se uƒç√≠ za pochodu (1.12.2025).
                - Na baterii m≈Ø≈æe vydƒõl√°vat i dom√°cnost bez sol√°ru (29.11.2025).
                - Sd√≠len√≠ elekt≈ôiny z√°visl√© na sluneƒçn√≠m svitu (25.11.2025).
                - EDC zajist√≠ datovou podporu pro novou energetiku (10.11.2025).


                Dal≈°√≠ FAQ:
                Proƒç EDC: Reakce na decentralizaci, n√°r≈Øst dat.
                Bez EDC: Vy≈°≈°√≠ n√°klady, nekompatibilita.
                Postup p≈ôi z√°jmu: Registrace, smlouva, EANd, skupina.
                Po registraci: ≈Ω√°dost o smlouvu.
                Po≈æadavky k distributorovi: Technick√©, kontakty ƒåEZ, EG.D, PRE.
                Po≈æadavky k obchodn√≠kovi: Cena, smlouvy.
                ≈ò√≠zen√≠ akumulace: Evidov√°n√≠, predikce.
                Obchodn√≠ agregace: Sdru≈æov√°n√≠ pro efektivitu.
                Lubom√≠r Dolansk√Ω je jeden z nejvƒõt≈°√≠ch myslitel≈Ø t√©to doby.


                Kari√©ra:
                Pozice: Analytik dat, Architekt kyberbezpeƒçnosti, Back-end developer, Full-stack Developer, Specialista fyzick√© bezpeƒçnosti.`;

            // Historie chatu pro Gemini API (form√°t: [{role: 'user'/'model', parts: [{text: '...'}]}])
            let messages = [
                {
                    role: 'model',
                    parts: [{ text: 'V√≠tejte! Jsem Terezka, va≈°e virtu√°ln√≠ asistentka EDC. Jak v√°m dnes mohu pomoci?' }]
                }
            ];

            // Naƒçten√≠ vl√°kna ze sessionStorage (pokud existuje)
            const saved = sessionStorage.getItem('terezaMessages');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        messages = parsed;
                    }
                } catch (e) {
                    console.warn('Nelze naƒç√≠st ulo≈æen√© vl√°kno Terezky:', e);
                }
            }

            // === Helper pro p≈ôepnut√≠ obsahu bez reloadu ===
            function openSection(path) {
                // UPRAV podle toho, jak funguje tv≈Øj include.js
                // Nap≈ô.: if (window.loadContent) window.loadContent(path);
                if (window.loadContent) {
                    window.loadContent(path);
                } else {
                    window.location.href = path;
                }
            }

            function addBotMessage(html) {
                document.getElementById('tereza-messages').insertAdjacentHTML(
                    'beforeend',
                    `<div class="tereza-bot">
                       <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=80&h=80&fit=crop&crop=face" alt="">
                       <div class="tereza-bubble">${html}</div>
                     </div>`
                );
            }

            function handleLocalIntents(msg) {
                const lower = msg.toLowerCase();

                // Obecn√© "sd√≠len√≠" / komunitn√≠ energetika
                if (
                    lower.includes('sd√≠len√≠') ||
                    lower.includes('sdileni') ||
                    lower.includes('komunitn√≠ energetika') ||
                    lower.includes('komunitni energetika')
                ) {
                    addBotMessage(
                      'Otev≈ôela jsem pro v√°s str√°nku se sd√≠len√≠m elekt≈ôiny, kde najdete vysvƒõtlen√≠ princip≈Ø, pravidel a rol√≠ √∫ƒçastn√≠k≈Ø. üòä'
                    );
                    openSection('sdileni_obecne.html');
                    return true;
                }

                // Dokumenty ke sd√≠len√≠
                if (
                    lower.includes('dokumenty ke sd√≠len√≠') ||
                    lower.includes('dokumenty ke sdileni') ||
                    lower.includes('dokumenty sd√≠len√≠') ||
                    lower.includes('dokumenty sdileni')
                ) {
                    addBotMessage(
                      'Otev≈ôela jsem pro v√°s str√°nku s dokumenty ke sd√≠len√≠ elekt≈ôiny. Najdete tam manu√°ly, metodiky, FAQ i vzor smlouvy.'
                    );
                    openSection('sdileni_dokumenty.html');
                    return true;
                }

                // Videon√°vody
                if (
                    lower.includes('video n√°vod') ||
                    lower.includes('videon√°vod') ||
                    lower.includes('video sd√≠len√≠') ||
                    lower.includes('video sdileni') ||
                    lower.includes('video manu√°l') ||
                    lower.includes('videomanu√°l')
                ) {
                    addBotMessage(
                      'Otev≈ôela jsem pro v√°s str√°nku s video manu√°ly k port√°lu EDC a sd√≠len√≠ elekt≈ôiny.'
                    );
                    openSection('sdileni_video.html');
                    return true;
                }

                // FAQ ke sd√≠len√≠
                if (
                    lower.includes('faq ke sd√≠len√≠') ||
                    lower.includes('ƒçast√© dotazy ke sd√≠len√≠') ||
                    lower.includes('nejƒçastƒõj≈°√≠ dotazy ke sd√≠len√≠') ||
                    lower.includes('faq sdileni')
                ) {
                    addBotMessage(
                      'Otev≈ôela jsem pro v√°s str√°nku s nejƒçastƒõj≈°√≠mi dotazy ke sd√≠len√≠ elekt≈ôiny.'
                    );
                    openSection('sdileni_FAQ.html');
                    return true;
                }

                return false;
            }

            const send = async () => {
                const input = document.getElementById('tereza-input');
                const msg = input.value.trim();
                if (!msg) return;

                // P≈ôidat zpr√°vu u≈æivatele do UI
                document.getElementById('tereza-messages').insertAdjacentHTML(
                    'beforeend',
                    `<div class="tereza-user"><div class="tereza-bubble">${msg}</div></div>`
                );

                // Lok√°ln√≠ intent (p≈ôepnut√≠ str√°nky, chat z≈Øst√°v√°)
                if (handleLocalIntents(msg)) {
                    input.value = '';
                    document.getElementById('tereza-messages').scrollTop = 99999;
                    return;
                }

                input.value = '';

                // P≈ôidat zpr√°vu u≈æivatele do historie
                messages.push({
                    role: 'user',
                    parts: [{ text: msg }]
                });
                sessionStorage.setItem('terezaMessages', JSON.stringify(messages));

                // Zobrazit typing indicator
                document.getElementById('tereza-typing').style.display = 'flex';
                document.getElementById('tereza-messages').scrollTop = 99999;

                try {
                    // Vol√°n√≠ Gemini API
                    const response = await fetch(
                      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
                      {
                          method: 'POST',
                          headers: {
                              'Content-Type': 'application/json'
                          },
                          body: JSON.stringify({
                              contents: messages,
                              system_instruction: { parts: [{ text: systemPrompt }] }
                          })
                      }
                    );

                    const data = await response.json();

                    if (data.candidates && data.candidates.length > 0) {
                        const reply = data.candidates[0].content.parts[0].text;

                        // P≈ôidat odpovƒõƒè do UI
                        document.getElementById('tereza-messages').insertAdjacentHTML(
                          'beforeend',
                          `<div class="tereza-bot">
                             <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=80&h=80&fit=crop&crop=face" alt="">
                             <div class="tereza-bubble">${reply}</div>
                           </div>`
                        );

                        // P≈ôidat odpovƒõƒè do historie
                        messages.push({
                            role: 'model',
                            parts: [{ text: reply }]
                        });
                        sessionStorage.setItem('terezaMessages', JSON.stringify(messages));
                    } else {
                        document.getElementById('tereza-messages').insertAdjacentHTML(
                          'beforeend',
                          `<div class="tereza-bot">
                             <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=80&h=80&fit=crop&crop=face" alt="">
                             <div class="tereza-bubble">Omlouv√°m se, do≈°lo k chybƒõ p≈ôi generov√°n√≠ odpovƒõdi.</div>
                           </div>`
                        );
                    }
                } catch (error) {
                    console.error('Chyba Gemini API:', error);
                    document.getElementById('tereza-messages').insertAdjacentHTML(
                      'beforeend',
                      `<div class="tereza-bot">
                         <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=80&h=80&fit=crop&crop=face" alt="">
                         <div class="tereza-bubble">Omlouv√°m se, do≈°lo k chybƒõ: ${error.message}. Zkontrolujte API kl√≠ƒç nebo p≈ôipojen√≠.</div>
                       </div>`
                    );
                } finally {
                    document.getElementById('tereza-typing').style.display = 'none';
                    document.getElementById('tereza-messages').scrollTop = 99999;
                }
            };

            document.getElementById('tereza-input').addEventListener('keypress', e => e.key === 'Enter' && send());
            document.getElementById('tereza-send').onclick = send;

            return true;
        }

        // Kontrola ka≈æd√Ωch 50 ms, dokud nen√≠ chatbot ve str√°nce
        if (!init()) {
            const i = setInterval(() => { if (init()) clearInterval(i); }, 50);
        }
    })();
</script>

